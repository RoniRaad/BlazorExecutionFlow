@page "/"
@using DrawflowWrapper.Components

<h1>Drawflow Blazor Wrapper Demo</h1>

<div class="controls" style="margin: 0 0 1rem 0;">
    <button @onclick="AddNode">Add Node</button>
    <button @onclick="Export">Export</button>
    <button @onclick="Clear">Clear</button>
</div>

<Drawflow @ref="_editor"
          Id="df-demo"
          Style="height:600px;"
          Options="new() { { "reroute", true } }"
          OnEvent="HandleEvent" />

@if (!string.IsNullOrWhiteSpace(_exportJson))
{
    <pre style="white-space:pre-wrap;border:1px solid #ddd;padding:8px;border-radius:8px;max-height:240px;overflow:auto;">@_exportJson</pre>
}

@code {
    private DrawflowBase? _editor;
    private string? _exportJson;

    private async Task HandleEvent(DrawflowEventArgs e)
    {
        // Log or handle drawflow events here
        Console.WriteLine($"Event: {e.Name} -> {e.PayloadJson}");
        await InvokeAsync(StateHasChanged);
    }

    private async Task AddNode()
    {
        if (_editor is null) return;
        await _editor.CallAsync<object>("addNode",
            "Demo", 1, 1, 150, 150, "demo-node",
            new { label = "Hello" },
            "<div style='padding:8px'>Hello Node</div>",
            false);
    }

    private async Task Export()
    {
        if (_editor is null) return;
        var exported = await _editor.CallAsync<object>("export");
        _exportJson = System.Text.Json.JsonSerializer.Serialize(exported, new System.Text.Json.JsonSerializerOptions { WriteIndented = true });
    }

    private async Task Clear()
    {
        if (_editor is null) return;
        await _editor.CallAsync<object>("clear");
        _exportJson = null;
    }
}
